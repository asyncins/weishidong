---
title: Python 代码审查指引与落地实施
sidebar: 'auto'
date: 2021-03-13
tags:
- Python 编程参考
- 实用技能

categories:
 - 编程参考
 - 实用技能
---

> 使用快捷键 Ctrl+D 或 Command+D 可快速收藏本技术专栏 收获爬虫架构/爬虫逆向/存储引擎/消息队列/Python/Golang相关知识



代码审查是一种前置的预防机制，能够在代码上线运行前发现其中隐藏着的问题，而不是在出现问题后再来排查问题根源。在实际工作中，没有严格执行代码审查往往使得问题深根发芽的，你总是能听到类似“**随便看看就行了**”、“**没什么好看的**”、“**哎呀，不可能有问题的**”的托词，如果你真的信了这些鬼话，那就等着天上掉棒槌吧。


## 代码审查查什么？


上面提到，代码审查的主要作用是提早发现隐藏的问题，那开发领域有哪些算是问题呢？粗略想想，大抵如下：


- [ ] 版权风险；
- [ ] 不遵守编码规范；
- [ ] 不遵循编程风格；
- [ ] 糟糕的设计；
- [ ] 顾左右而言他的注释；
- [ ] 不稳定的对象；
- [ ] 不可靠的服务；



**版权风险**：开发领域向来容易引发版权风险，我们使用的商业软件、商业服务、商业三方库、多媒体文件、字体（以下统称商业服务）等，这种场景需要公司提供一份版权清单，清单上罗列哪些明令禁止使用的以及可申请采购授权的商业服务；


**不遵守编码规范**/**不遵循编程风格**：不遵守编码规范容易引起多成员之间协作的效率，而且容易造成运行时隐患。当发生人事变动的时候，这份代码就会变成“**祖传代码**”，难以维护；


**顾左右而言他的注释**：代码明明向东，注释却写着向北，这很容易引起阅读者的误解，导致在功能扩展、重构的时候产生错误的决策；


**糟糕的设计**：违反编程范式、萝卜白菜一锅炖、if else 满天飞，到了项目升级、功能扩展、项目重构的时候，这些“**祖传的技术债务**”就是噩梦；


**不稳定的对象**：不稳定的对象其实来源于糟糕的设计，例如一个函数完成了几件事、一个类容纳了几种无关的函数，这样的设计会造成对象的不稳定，导致调用方很难确定对象稳定性，进而影响整体稳定性；


**不可靠的服务**：没有监控、没有细致的日志记录、没有应对超额流量的方案……


> 版权水印 - 韦世东的技术专栏 https://www.weishidong.com




## 落地实践为王

代码审查落地执行其实可以很轻松，每个人按照自检清单先自查一遍，审查人员再按照自检清单审查一遍，只要没有发现隐藏的问题，就通过检查。

![](https://img.weishidong.com/20210312221034.png)



## 代码审查辅助工具


大多数时候，代码审查都需要依靠人工进行，但在编码规范和编程风格这里可以借助一些辅助工具进行梳理，工具梳理完成后再进行人工梳理，可以提高审查效率，这里以 PYLINT （文档地址 [http://pylint.pycqa.org/en/latest/user_guide/run.html](http://pylint.pycqa.org/en/latest/user_guide/run.html)）为例。


首先通过命令 `pip install pylint` 安装 PYLINT 库，接着通过命令 `pylint -h` 查看使用帮助。初次接触 PYLINT 的朋友可能有点找不着北，我们用一种简单的方式入手吧。PYLINT 可以检查**指定的文件（PYTHON 文件）**或者**指定目录**下的 PYTHON 文件，并且给出检查结果。假设目录结构如下：
```python
|-- src  
| |-- README.md  
| |-- conponents.py 
```
如果想要检测 `conponents.py` 文件，只需要执行 `pylint ./src/conponents.py` 即可。默认情况下，PYLINT 会将检查结果打印在控制台，例如：
```python
************* Module src.conponents
src/conponents.py:320:0: C0301: Line too long (117/100) (line-too-long)
src/conponents.py:321:0: C0301: Line too long (117/100) (line-too-long)
src/conponents.py:473:8: W0612: Unused variable 'items' (unused-variable)
src/conponents.py:159:0: R0903: Too few public methods (1/2) (too-few-public-methods)
```
检查结果的格式为 **[文件路径][行数][列数][级别][说明]**，PYLINT 内置的结果级别如下：


- [ ] C 违反了编码风格标准； 
- [ ] R 写得非常糟糕的代码；
- [ ] W 某些 Python 特定的问题；
- [ ] E  很可能是代码中的错误；
- [ ] F  阻止 PYLINT 进一步检查的错误；



例如上述示例中的 `C0301` 和后面的说明告诉我们，这一行代码太长了！ `R0903` 和后面的说明告诉我们这个类中的公共函数太少了！


<Vssue :title="$title" />

