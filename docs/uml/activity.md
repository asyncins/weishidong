---
title: 活动图 Activity
date: 2020-07-20
tags:
 - 活动图
 - UML
 - 流程图
 - 泳道图

sidebar: 'auto'
categories:
 - 实用技能
---

活动图用来描述一个操作或者一组操作的过程，它比协作图更像流程图。实际上除了图形元素稍有区别，我甚至都不知道它和流程图有什么差异。



## 活动图的表示

活动图中有几个重要的图形元素，我们先来认识一下。一个代表活动的圆角矩形、一个代表活动起点的实心圆和一个代表活动终点的环形圆。具体表示如下图所示。

![image-20200719212011006](https://img.weishidong.com/image-20200719212011006.png)

上图描述了活动迁移的过程，即从活动 A 迁移到互动 B 的过程。好简单啊，如果把实心圆换成圆角矩形，圆角矩形换成直角举行，再去掉环形圆，那这就是个流程图了。

要注意的是，活动图中代表活动的圆角矩形比状态图中的圆角矩形更圆润一些，不要弄混了哦。

## 条件判断

和我们熟知的流程图一样，活动图也有条件判断的场景。假设一个活动序列在某个活动上要根据条件做出选择，那么就需要用到以菱形元素为表示的判断符。例如在京东上购买商品时，你会根据购物车总价选择继续添加商品还是去结算，具体如下图所示。

![image-20200719212858367](https://img.weishidong.com/image-20200719212858367.png)



## 并发执行

并发进行两个活动是很正常的事，尤其是在追求高性能的今天。以生活场景为例，你可能会在洗衣服的间隙去拖地（这里不咬文嚼字并发和并行）。UML 约定活动图中的并发执行用上下两条加粗横线表示，在两条横线中间的活动视为并发执行，具体表示如下。

![image-20200719213641885](https://img.weishidong.com/image-20200719213641885.png)



## 信号

在实际的程序设计或者生活场景中，经常会有**触发**这样的需求。比如空调定时关闭，时间到了就触发关闭函数。再比如电磁炉加热到一定温度就暂停加热，稍后根据温度再次启动加热功能。

那么问题来了，如何让一个对象知道它应该运行还是应该停止呢？

常用的办法是信号，由另外一个对象给它传递信号，它根据信号切换启停状态。比如空调定时器给电源控制器发送关闭信号，又比如电磁炉温感器给加热器发送加热信号。

在 UML 中，以凸角五边形表示信号发送方，以凹角五边形表示信号接收方，信号的传递以虚线箭头表示。电磁炉发送和接收信号的活动图如下所示。

![image-20200720115042750](https://img.weishidong.com/image-20200720115042750.png)

我绘图的时候并未在图形里找到凹角五边形，这里暂时用矩形代替。在电磁炉的工作逻辑中，启动电磁炉的加热器后一般由温感器监控温度，当温度达到阈值时就调用相关函数停止加热，与此同时更改面板上显示的功率数值和状态值。



## 如何表示异常

异常处理是每一门编程语言都会提供的稳定性保障机制，例如 Python 中的 try except，Golang 中的 if err != nil。异常是程序设计过程中必须考虑的问题，例如网络请求发出去后得不到响应时程序应该抛出一个超时异常。

在 UML 中，异常用一个折现箭头表示，并且箭头通常指向一个活动。听起来果然是很绕，我们根据场景和图来理解它吧。还是以电磁炉加热为例，厂家为了保障用户安全，给电磁炉温感器设定了一个绝对阈值，当温度超过绝对阈值时引发高温异常，主动切断电源以防止温度继续升高。对应的活动图如下所示。

![image-20200720120432861](https://img.weishidong.com/image-20200720120432861.png)

当然，这里的条件判断其实是可以省略的，我们换一种表达方式即可。

![image-20200720120932632](https://img.weishidong.com/image-20200720120932632.png)



## 泳道图

在设计和开发的过程中，我们经常需要划分不同模块或者不同角色之间的活动，比如在用户上网浏览网页的过程中，角色通常为用户、浏览器、服务端。再比如在前面几篇中提到的空调场景，角色可以分为拥有者、遥控器、空调。

你发现了吗？这跟时序图中的角色定义是相同的，时序图以矩形和虚线来划分角色，而活动图中通常以泳道来划分角色。

![vBYn3t](https://img.weishidong.com/vBYn3t.png)

没错，正是游泳比赛中的泳道。泳道的划分主要是为了避免参赛者偏离方向导致影响到其他选手的发挥，每个选手在自己的泳道中前行，如果越界了也职责清晰。在程序设计中，泳道的作用与此相似。

这里我们以英雄联盟游戏场景为例，学习泳道图的相关知识。玩游戏时可以粗略划分为三个角色：玩家、操作器、游戏程序。这里的操作器对应的是鼠标和键盘，游戏程序的运行会表现在显示器上。当玩家（召唤师）操纵游戏人物（卡莉斯塔）从一个位置（上路）移动到另一个位置（峡谷先锋）时，具体的泳道图示如下。

![image-20200720123327429](https://img.weishidong.com/image-20200720123327429.png)

每个角色都拥有自己的泳道，泳道以可垂直增长的矩形表示，跟角色相关的活动都放在对应的泳道中。角色与角色之间可能相距多个泳道，但它们却常有交互，所以在泳道图中允许箭头跨越泳道。上图中的虚线箭头类似时序图中的返回，但也可以用来表示活动和活动执行结果，UML 中并无特殊要求，我们可灵活使用。